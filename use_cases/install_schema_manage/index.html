<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../..//img/favicon.ico">

        <title>Install and manage chado schema - Chado Sqitch Documentation</title>

        <link href="../..//css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../..//css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../..//css/prettify-1.0.css" rel="stylesheet">
        <link href="../..//css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../">Chado Sqitch Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../">About</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Use Cases <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../install_schema_only/">Install chado schema</a>
                            </li>
                        
                            <li class="active">
                                <a href="./">Install and manage chado schema</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../install_schema_only/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li class="disabled">
                    <a rel="prev" >
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/dictyBase/Chado-Sqitch">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#install-chado-schema-and-manage-database-changes">Install chado schema and manage database changes</a></li>
        
            <li><a href="#circumstance">Circumstance</a></li>
        
            <li><a href="#steps">Steps</a></li>
        
            <li><a href="#clone-this-repository">Clone this repository</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="install-chado-schema-and-manage-database-changes">Install chado schema and manage database changes</h2>
<h3 id="circumstance">Circumstance</h3>
<p>Installation of chado schema for extending and customization. Also, might need
to add other database tables, schemas that is unrelated to chado but needed to
work with software application layer, for example user management tables.</p>
<h3 id="steps">Steps</h3>
<h4 id="install-git">Install git</h4>
<p>Preferably use the package manager of your OS.</p>
<h3 id="clone-this-repository">Clone this repository</h3>
<pre class="prettyprint well"><code>$_&gt; git clone https://github.com/dictyBase/Chado-Sqitch
$_&gt; cd Chado-sqitch
</code></pre>

<h4 id="install-sqitch">Install sqitch</h4>
<p>Follow the instruction from <a href="http://sqitch.org">sqitch</a> website.</p>
<pre class="prettyprint well"><code>#For MacOSX
$_&gt; brew tap theory/sqitch
$_&gt; brew install sqitch_pg

#For Windows
$_&gt; ppm install App-Sqitch

#And from source using cpanminus
$_&gt; cpanm DBD::Pg App::Sqitch
</code></pre>

<h4 id="install-postgresql">Install postgresql</h4>
<p>Not neccessary if there is one already available locally or in another host.</p>
<h4 id="create-database-and-user">Create database and user</h4>
<p>The following commands with create a <code>gmod</code> user and database in a
locally available postgresql database. This particular user/database
combination is refered throughout the examples.</p>
<pre class="prettyprint well"><code>$_&gt; createuser -E -l -U &lt;superuser&gt; gmod
$_&gt; createdb -O gmod -U &lt;superuser&gt; gmod
</code></pre>

<h4 id="create-sqitch-configuration">Create sqitch configuration</h4>
<p>The sqitch configuration file is generally ignored in the git repository and
should not commited. This project comes with one example. In fact every user
should use their own configuration file.</p>
<pre class="prettyprint well"><code>$_&gt; cp sqitch.conf.sample sqitch.conf
</code></pre>

<p>Add configuration parameters</p>
<pre class="prettyprint well"><code>$_&gt; sqitch config --user user.name &quot;user name&quot;
$_&gt; sqitch config --user user.email &quot;user email&quot;
$_&gt; sqitch config --user core.pg.client `which psql`
</code></pre>

<p>The above user will be used tied to all changes made from this checkout of the
repository.</p>
<h4 id="add-database-configuration">Add database configuration</h4>
<p>It assumes a postgresql server running locally with a database, user and
password with <strong>gmod</strong>. It allows to run the commands without specifying them
everytime. The database connection URI
<a href="https://metacpan.org/pod/URI::db">specification</a> is given here.</p>
<pre class="prettyprint well"><code>$_&gt; sqitch target add gmod db:pg://gmod:gmod@localhost/gmod
$_&gt; sqitch config core.pg.target gmod
</code></pre>

<h4 id="deploy-database-schema">Deploy database schema</h4>
<p>By default it will install chado-1.23 in the default postgresql database.</p>
<pre class="prettyprint well"><code>$_&gt; sqitch deploy
</code></pre>

<p>To install a previous version, use the particular tag</p>
<pre class="prettyprint well"><code>$_&gt; sqitch deploy @chado-1.11
</code></pre>

<p>Of course, the same schema could be deployed in multiple  databases by adding
more target.</p>
<h4 id="customization">Customization</h4>
<p>Once the core chado is installed, any new customization or changes can be
added using sqitch. To understand the basic sqitch command, do go through this
sqitch documentation and official
<a href="https://metacpan.org/pod/distribution/App-Sqitch/lib/sqitchtutorial.pod">tutorial</a>.</p>
<p><strong> Adding changes</strong></p>
<pre class="prettyprint well"><code>$_&gt; sqitch add mychange -n 'my first change on chado database'
</code></pre>

<p>It will create three folders <code>deploy</code>, <code>revert</code> and <code>verify</code> each
with a single file named <code>mychange.sql</code>. Add your sql statements to each of
this file and then deploy.</p>
<pre class="prettyprint well"><code>$_&gt; sqitch deploy
</code></pre>

<p><strong>Verify changes</strong></p>
<p>To make sure each deploy gets verified</p>
<pre class="prettyprint well"><code>$_&gt; sqitch config --bool deploy.verify true 
</code></pre>

<p><strong>Save changes</strong></p>
<p>Now, save all changes to git</p>
<pre class="prettyprint well"><code>$_&gt; git add sqitch.plan deploy revert verify
$_&gt; git commit -n 'added my first change'
</code></pre>

<p>Optionally push it to remote</p>
<pre class="prettyprint well"><code>$_&gt; git push myremote
</code></pre>

<p><strong>Revert changes</strong></p>
<p>In case the change is not desirable and would like to get back the core chado</p>
<pre class="prettyprint well"><code>$_&gt; sqitch revert --to @chado-1.23
</code></pre>

<h4 id="syncronization">Syncronization</h4>
<p><code>Chado-Sqitch</code> integrates all chado updates in the master branch. So, to
stay uptodate, merge with the master branch.</p>
<pre class="prettyprint well"><code>$_&gt; git fetch origin &amp;&amp; git merge master
$_&gt; sqitch deploy
</code></pre>

<p>Last but not the least, it's a better idea to push the local changes to its own
remote repository.</p>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../..//js/bootstrap-3.0.3.min.js"></script>
        <script src="../..//js/prettify-1.0.min.js"></script>
        <script src="../..//js/base.js"></script>
        
    </body>
</html>